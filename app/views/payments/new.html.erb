<div class="checkout">
  <div class="filled-cart">
    <div class="cart-recap">
      <div class="cart-content-header">
        <i class="fa fa-medkit normal-icon"></i>
        <p>Vos pills</p>
        <div class="items-count"><%= @cart.nb_items %></div>
      </div>
      <button type="button" data-dismiss="modal" class="btn btn-dismiss"><i class="fa fa-times"></i></button>
    </div>
    <div class="cart-info">
      <div class="cart-content">
        <div class="blue-icon"><i class="fa fa-map-marker"></i></div>
        <p><%= @cart.delivery_location %></p>
      </div>
      <div class="pencil-icon">
        <div><i class="fa fa-pencil-square btn" data-toggle="modal" data-target="#pickers"></i></div>
      </div>
    </div>
    <div class="cart-info">
      <div class="cart-content">
        <div class="blue-icon"><i class="fa fa-clock-o"></i></div>
        <p>Livraison dans <%= @duration %> minutes</p>
      </div>
      <div class="pencil-icon">
        <div><i class="fa fa-pencil-square btn" data-toggle="modal" data-target="#pickers"></i></div>
      </div>
    </div>
    <div class="cart-products">
      <% @cart.cart_items.each do |cart_item| %>
        <div class="cart-product">
          <div class="item-picture">
            <%= image_tag cart_item.pill.photo %>
          </div>
          <div class="item-description">
            <p><%= cart_item.pill.name %></p>
            <p><%= cart_item.pill.capacity %></p>
          </div>
          <div class="item-total">
            <p><%= cart_item.quantity %> x <b><%= cart_item.pill.price %>€</b></p>
            <div class="cart-control">
              <%= simple_form_for [cart_item.pill, cart_item], method: :patch do |f| %>
                <%= f.hidden_field :cart_id, value: @cart.id %>
                <%= button_tag(type: 'submit', class: "divbutton-small") do %>
                  <span>-</span>
                <% end %>
              <% end %>
              <%= simple_form_for [cart_item.pill, cart_item], method: :post, url: pill_cart_items_path(cart_item.pill) do |f| %>
                <%= f.hidden_field :cart_id, value: @cart.id %>
                <%= button_tag(type: 'submit', class: "divbutton-small") do %>
                  <span>+</span>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <div class="cart-info">
      <div class="cart-content">
        <div class="blue-icon"><i class="fa fa-ambulance"></i></div>
        <p>Frais de livraison</p>
      </div>
      <div class="delivery-fees">
        <p><%= @cart.delivery_price %> €</p>
      </div>
    </div>
    <div class="cart-total">
      <div class="total underlined">
        <p>Total</p>
      </div>

      <%= form_tag payments_path do %>
        <div class="sum">
          <article>
            <label class="amount">
              <span><%= @cart.total %> €</span>
            </label>
          </article>
        </div>
        <div class="cart-payment">
          <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
            data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
            data-name="Mon Panier"
            data-email="<%= current_user.email %>"
            data-description="<%= @cart.delivery_location %>"
            data-amount="<%= @cart.total %>"
            data-currency="<%= %>"></script>
        </div>
      <% end %>
    </div>
  </div>
</div>
